[uWSGI] getting INI configuration from integrated_display_uwsgi.ini
*** Starting uWSGI 2.0.14 (64bit) on [Thu Apr 13 09:46:12 2017] ***
compiled with version: 4.4.7 20120313 (Red Hat 4.4.7-11) on 08 March 2017 11:44:30
os: Linux-2.6.32-358.el6.x86_64 #1 SMP Fri Feb 22 00:31:26 UTC 2013
nodename: localhost.localdomain
machine: x86_64
clock source: unix
pcre jit disabled
detected number of CPU cores: 4
current working directory: /root/hf/integrated_display
detected binary path: /usr/local/Python2.7/bin/uwsgi
uWSGI running as root, you can use --uid/--gid/--chroot options
*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** 
chdir() to /root/hf/integrated_display
your processes number limit is 256500
your memory page size is 4096 bytes
detected max file descriptor number: 102400
lock engine: pthread robust mutexes
thunder lock: disabled (you can enable it with --thunder-lock)
uwsgi socket 0 bound to TCP address :8099 fd 3
Python version: 2.7.12 (default, Jul 13 2016, 11:19:57)  [GCC 4.4.7 20120313 (Red Hat 4.4.7-11)]
*** Python threads support is disabled. You can enable it with --enable-threads ***
Python main interpreter initialized at 0x164aaa0
your server socket listen backlog is limited to 100 connections
your mercy for graceful operations on workers is 60 seconds
mapped 363840 bytes (355 KB) for 4 cores
*** Operational MODE: preforking ***
WSGI app 0 (mountpoint='') ready in 0 seconds on interpreter 0x164aaa0 pid: 32074 (default app)
*** uWSGI is running in multiple interpreter mode ***
spawned uWSGI master process (pid: 32074)
spawned uWSGI worker 1 (pid: 32091, cores: 1)
spawned uWSGI worker 2 (pid: 32092, cores: 1)
spawned uWSGI worker 3 (pid: 32093, cores: 1)
spawned uWSGI worker 4 (pid: 32094, cores: 1)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170412' GROUP BY date) a;
[(Decimal('107957560.500000000000'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 4.61198687553
[pid: 32094|app: 0|req: 1/1] 10.100.253.14 () {42 vars in 828 bytes} [Thu Apr 13 01:46:20 2017] GET /display/ => generated 29157 bytes in 4660 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170412' GROUP BY date) a;
[(Decimal('107957560.500000000000'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 5.77445006371
[pid: 32093|app: 0|req: 1/2] 172.31.24.226 () {40 vars in 756 bytes} [Thu Apr 13 01:46:34 2017] GET /display/ => generated 29157 bytes in 5813 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '308703', '312733', '310398', '308734', '308710', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 2/3] 172.31.24.226 () {42 vars in 840 bytes} [Thu Apr 13 01:48:04 2017] GET /display/channel/?name=show => generated 27653 bytes in 6358 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (7,88) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170327' and date<='20170402' and pid in (8427,290982,8031,307747,290227,291076,307839,168568,168521,9148,312567,310504,312413,291174,309588,291325,151066,311038,304867,309973,302045,310404,159339,156998,308378,48267,293426,310880,167540,155982,293609,310803,292056,168154,309257,294247,56215,150723,296178,168519,291088,291089,313650,311589,291080,313106,313589,292555,293435,158776) group by pid 
pid_vv_change_list: [[u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', Decimal('7081733'), Decimal('7904325'), -10.4], [u'\u5154\u5c0f\u8d1d\u513f\u6b4c', Decimal('740680'), Decimal('775183'), -4.5], [u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', Decimal('1504079'), Decimal('1554670'), -3.3], [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', Decimal('2297643'), Decimal('2305958'), -0.4], [u'\u8d1d\u74e6\u513f\u6b4c', Decimal('2896049'), Decimal('2882117'), 0.5], [u'\u732a\u732a\u4fa0\uff1a\u5fae\u80d6\u754c\u7684\u8d85\u7ea7\u82f1\u96c4', Decimal('1439178'), Decimal('1382881'), 4.1], [u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', Decimal('706408'), Decimal('676701'), 4.4], [u'\u96f6\u96f6\u5927\u5192\u9669\u7cbe\u5f69\u96c6\u9526', Decimal('690204'), Decimal('653297'), 5.6], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', Decimal('1098931'), Decimal('1009239'), 8.9], [u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', Decimal('3037070'), Decimal('2775146'), 9.4], [u'\u5c0f\u9e21Jaki\u5728\u54ea\u513f', Decimal('3914657'), Decimal('3574653'), 9.5], [u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', Decimal('10897428'), Decimal('9904284'), 10.0], [u'\u5012\u9709\u718a \u7b2c\u4e09\u5b63', Decimal('1015870'), Decimal('921306'), 10.3], [u'larva\uff08\u7206\u7b11\u866b\u5b50\uff09\u5168\u96c6', Decimal('704660'), Decimal('638585'), 10.3], [u'\u8d85\u7ea7\u6c6a\u6c6a\u961f\u8054\u76df', Decimal('657208'), Decimal('593448'), 10.7], [u'\u6885\u897f\u53bb\u4e50\u8da3\u5c9b', Decimal('738442'), Decimal('664008'), 11.2], [u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', Decimal('2750522'), Decimal('2460975'), 11.8], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u513f\u6b4c\u7cfb\u5217', Decimal('936396'), Decimal('835841'), 12.0], [u'\u6211\u7684\u4f1a\u8bf4\u8bdd\u7684\u6c64\u59c6', Decimal('2801590'), Decimal('2472817'), 13.3], [u'\u4e09\u53ea\u5154\u5b50', Decimal('669635'), Decimal('589320'), 13.6], [u'\u5b9d\u5b9d\u5df4\u58eb\u4e4b\u795e\u5947\u7b80\u7b14\u753b', Decimal('1139431'), Decimal('995362'), 14.5], [u'\u5947\u79ef\u4e50\u56ed', Decimal('678559'), Decimal('586322'), 15.7], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e8c\u5b63', Decimal('1541227'), Decimal('1328697'), 16.0], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', Decimal('2788136'), Decimal('2384484'), 16.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', Decimal('1335347'), Decimal('1141019'), 17.0], [u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', Decimal('1144790'), Decimal('974655'), 17.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c3\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c\u4e09\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e09\u5b63', Decimal('751866'), Decimal('631381'), 19.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e00\u5b63', Decimal('1274685'), Decimal('1069057'), 19.2], [u'\u5c0f\u9ec4\u4eba\u756a\u5916\u7bc7\u5408\u96c6', Decimal('1062982'), Decimal('885149'), 20.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', Decimal('746238'), Decimal('620773'), 20.2], [u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', Decimal('1785943'), Decimal('1473041'), 21.2], [u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', Decimal('1484909'), Decimal('1223637'), 21.4], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', Decimal('4527298'), Decimal('3715107'), 21.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', Decimal('5124565'), Decimal('4188583'), 22.3], [u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', Decimal('3296093'), Decimal('2673396'), 23.3], [u'\u6b22\u4e50\u8d31\u840c\u5c0f\u9ec4\u4eba\u52a8\u753b\u96c6\u9526', Decimal('836978'), Decimal('668634'), 25.2], [u'\u6b22\u4e50\u5947\u8da3\u86cb', Decimal('697826'), Decimal('548590'), 27.2], [u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', Decimal('3275074'), Decimal('2550141'), 28.4], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f \u7b2c\u56db\u5b63', Decimal('941896'), Decimal('706659'), 33.3], [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', Decimal('1069425'), Decimal('800254'), 33.6], [u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', Decimal('1561363'), Decimal('1152511'), 35.5], [u'\u87ba\u4e1d\u9489', Decimal('1925157'), Decimal('1417198'), 35.8], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', Decimal('897725'), Decimal('645331'), 39.1], [u'\u5df4\u5df4\u7238\u7238', Decimal('666946'), Decimal('468975'), 42.2], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', Decimal('758053'), Decimal('532266'), 42.4], [u'\u72d0\u5996\u5c0f\u7ea2\u5a18', Decimal('685134'), Decimal('455458'), 50.4], [u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', Decimal('670797'), Decimal('417987'), 60.5], [u'\u661f\u517d\u730e\u4eba', Decimal('1126701'), Decimal('620404'), 81.6], [u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', Decimal('2307506'), Decimal('1236930'), 86.6]]
{'decrease_vv': [-0.4, -3.3, -4.5, -10.4], 'decrease_name': [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', u'\u5154\u5c0f\u8d1d\u513f\u6b4c', u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63'], 'increase_vv': [33.6, 35.5, 35.8, 39.1, 42.2, 42.4, 50.4, 60.5, 81.6, 86.6], 'increase_name': [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', u'\u87ba\u4e1d\u9489', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', u'\u5df4\u5df4\u7238\u7238', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', u'\u72d0\u5996\u5c0f\u7ea2\u5a18', u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', u'\u661f\u517d\u730e\u4eba', u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (8427,290982,313803,290227,307839,156998,168521,312567,310504,167972,309588,291325,311038,304867,309973,293426,293609,292159,291089,313650,312413,313106,313589,293435) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a
cms_result: ['310504', '293435', '290982', '293426', '304867', '291089', '293609', '309588', '167972', '313650', '168521', '8427', '312567', '311038', '309973', '292159', '307839', '291325', '313589', '313106', '156998', '312413', '313803', '290227']
uv_pid_day_avg_result: ['313589', '310504', '307839', '312413', '304867', '312567', '290982', '311038', '167972', '292159', '310504', '309973', '291089', '8427', '293426', '313803', '291325', '313589', '293609', '168521', '309973', '291089', '313106', '290227', '293426', '293609', '310504', '313650', '312413', '293435', '310504', '309973', '313803', '313106', '291089', '313589', '8427', '309588', '291325', '156998']
vv_pid_day_avg_result: ['168521', '167972', '292159', '293426', '311038', '304867', '168521', '307839', '304867', '313589', '307839', '313589', '291089', '313803', '313650', '290227', '290227', '156998', '293609', '293435', '313589', '8427', '293426', '291325', '290227', '156998', '167972', '311038', '313106', '8427', '156998', '309973', '313106', '309973', '8427', '156998', '313650', '312413', '312567', '291325', '304867', '309973', '290982', '290982', '168521', '291325', '307839', '293609', '293609', '310504', '313803', '312567', '309588', '309588', '291089', '312567', '292159', '290982', '310504', '309973', '292159', '307839', '312413', '311038', '311038', '309588', '292159', '293426', '304867', '313803', '293426', '313803', '168521', '310504', '313106', '312567', '313650', '290227', '293435', '290982', '291325', '293435', '312413', '312413', '310504', '313650', '291089', '293609', '167972', '167972', '309588', '291089', '293435', '313589', '313106', '8427']
[[[5.4, 17.6, 3.3, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'pcweb'], [3.9, 9.6, 2.5, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'pcweb'], [2.6, 16.8, 6.4, u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', 'pcweb'], [1.9, 6.7, 3.5, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'pcweb'], [1.1, 5.5, 4.9, u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', 'pcweb'], [1.1, 4.8, 4.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', 'pcweb'], [1.0, 5.7, 5.4, u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', 'pcweb'], [1.0, 1.8, 1.8, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', 'pcweb'], [1.0, 5.2, 5.2, u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u5168\u96c6', 'pcweb'], [0.9, 6.3, 6.7, u'\u75af\u72c2\u7684\u5154\u5b50 \u7b2c\u4e8c\u5b63', 'pcweb']], [[2.2, 12.0, 5.4, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'android'], [1.9, 12.1, 6.3, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'android'], [1.9, 4.1, 2.2, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'android'], [1.4, 5.1, 3.6, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'android'], [1.4, 6.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'android'], [1.1, 3.3, 3.0, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'android'], [1.1, 7.1, 6.5, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'android'], [1.1, 3.3, 3.0, u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', 'android'], [1.0, 5.8, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'android'], [1.0, 3.8, 3.9, u'\u72d0\u5996\u5c0f\u7ea2\u5a18', 'android']], [[0.6, 3.8, 6.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'iphone'], [0.4, 3.0, 6.6, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'iphone'], [0.3, 1.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'iphone'], [0.3, 2.3, 6.8, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'iphone'], [0.3, 1.8, 6.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'iphone'], [0.3, 0.7, 2.4, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'iphone'], [0.2, 1.3, 5.7, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'iphone'], [0.2, 0.6, 2.9, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'iphone'], [0.2, 1.1, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'iphone'], [0.2, 0.8, 4.4, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', 'iphone']], [[12.2, 74.1, 6.1, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'ott'], [5.2, 54.2, 10.5, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'ott'], [4.8, 15.6, 3.3, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'ott'], [4.5, 143.6, 31.9, u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', 'ott'], [4.4, 24.2, 5.6, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'ott'], [4.0, 35.7, 9.0, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'ott'], [3.9, 11.4, 3.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'ott'], [3.7, 11.1, 3.0, u'\u661f\u517d\u730e\u4eba', 'ott'], [2.5, 12.1, 4.8, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'ott'], [2.5, 38.7, 15.6, u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 3/4] 172.31.24.94 () {40 vars in 800 bytes} [Thu Apr 13 02:38:29 2017] GET /display/channel/?name=cartoon => generated 27459 bytes in 4440 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
[pid: 32093|app: 0|req: 2/5] 172.31.24.94 () {42 vars in 865 bytes} [Thu Apr 13 02:38:45 2017] GET /display/channel/forms.html => generated 100 bytes in 5 msecs (HTTP/1.1 404) 2 headers in 80 bytes (1 switches on core 0)
[pid: 32092|app: 0|req: 1/6] 172.31.24.94 () {40 vars in 726 bytes} [Thu Apr 13 02:38:45 2017] GET /favicon.ico => generated 85 bytes in 31 msecs (HTTP/1.1 404) 2 headers in 80 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (7,88) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170327' and date<='20170402' and pid in (8427,290982,8031,307747,290227,291076,307839,168568,168521,9148,312567,310504,312413,291174,309588,291325,151066,311038,304867,309973,302045,310404,159339,156998,308378,48267,293426,310880,167540,155982,293609,310803,292056,168154,309257,294247,56215,150723,296178,168519,291088,291089,313650,311589,291080,313106,313589,292555,293435,158776) group by pid 
pid_vv_change_list: [[u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', Decimal('7081733'), Decimal('7904325'), -10.4], [u'\u5154\u5c0f\u8d1d\u513f\u6b4c', Decimal('740680'), Decimal('775183'), -4.5], [u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', Decimal('1504079'), Decimal('1554670'), -3.3], [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', Decimal('2297643'), Decimal('2305958'), -0.4], [u'\u8d1d\u74e6\u513f\u6b4c', Decimal('2896049'), Decimal('2882117'), 0.5], [u'\u732a\u732a\u4fa0\uff1a\u5fae\u80d6\u754c\u7684\u8d85\u7ea7\u82f1\u96c4', Decimal('1439178'), Decimal('1382881'), 4.1], [u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', Decimal('706408'), Decimal('676701'), 4.4], [u'\u96f6\u96f6\u5927\u5192\u9669\u7cbe\u5f69\u96c6\u9526', Decimal('690204'), Decimal('653297'), 5.6], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', Decimal('1098931'), Decimal('1009239'), 8.9], [u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', Decimal('3037070'), Decimal('2775146'), 9.4], [u'\u5c0f\u9e21Jaki\u5728\u54ea\u513f', Decimal('3914657'), Decimal('3574653'), 9.5], [u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', Decimal('10897428'), Decimal('9904284'), 10.0], [u'\u5012\u9709\u718a \u7b2c\u4e09\u5b63', Decimal('1015870'), Decimal('921306'), 10.3], [u'larva\uff08\u7206\u7b11\u866b\u5b50\uff09\u5168\u96c6', Decimal('704660'), Decimal('638585'), 10.3], [u'\u8d85\u7ea7\u6c6a\u6c6a\u961f\u8054\u76df', Decimal('657208'), Decimal('593448'), 10.7], [u'\u6885\u897f\u53bb\u4e50\u8da3\u5c9b', Decimal('738442'), Decimal('664008'), 11.2], [u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', Decimal('2750522'), Decimal('2460975'), 11.8], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u513f\u6b4c\u7cfb\u5217', Decimal('936396'), Decimal('835841'), 12.0], [u'\u6211\u7684\u4f1a\u8bf4\u8bdd\u7684\u6c64\u59c6', Decimal('2801590'), Decimal('2472817'), 13.3], [u'\u4e09\u53ea\u5154\u5b50', Decimal('669635'), Decimal('589320'), 13.6], [u'\u5b9d\u5b9d\u5df4\u58eb\u4e4b\u795e\u5947\u7b80\u7b14\u753b', Decimal('1139431'), Decimal('995362'), 14.5], [u'\u5947\u79ef\u4e50\u56ed', Decimal('678559'), Decimal('586322'), 15.7], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e8c\u5b63', Decimal('1541227'), Decimal('1328697'), 16.0], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', Decimal('2788136'), Decimal('2384484'), 16.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', Decimal('1335347'), Decimal('1141019'), 17.0], [u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', Decimal('1144790'), Decimal('974655'), 17.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c3\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c\u4e09\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e09\u5b63', Decimal('751866'), Decimal('631381'), 19.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e00\u5b63', Decimal('1274685'), Decimal('1069057'), 19.2], [u'\u5c0f\u9ec4\u4eba\u756a\u5916\u7bc7\u5408\u96c6', Decimal('1062982'), Decimal('885149'), 20.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', Decimal('746238'), Decimal('620773'), 20.2], [u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', Decimal('1785943'), Decimal('1473041'), 21.2], [u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', Decimal('1484909'), Decimal('1223637'), 21.4], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', Decimal('4527298'), Decimal('3715107'), 21.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', Decimal('5124565'), Decimal('4188583'), 22.3], [u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', Decimal('3296093'), Decimal('2673396'), 23.3], [u'\u6b22\u4e50\u8d31\u840c\u5c0f\u9ec4\u4eba\u52a8\u753b\u96c6\u9526', Decimal('836978'), Decimal('668634'), 25.2], [u'\u6b22\u4e50\u5947\u8da3\u86cb', Decimal('697826'), Decimal('548590'), 27.2], [u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', Decimal('3275074'), Decimal('2550141'), 28.4], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f \u7b2c\u56db\u5b63', Decimal('941896'), Decimal('706659'), 33.3], [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', Decimal('1069425'), Decimal('800254'), 33.6], [u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', Decimal('1561363'), Decimal('1152511'), 35.5], [u'\u87ba\u4e1d\u9489', Decimal('1925157'), Decimal('1417198'), 35.8], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', Decimal('897725'), Decimal('645331'), 39.1], [u'\u5df4\u5df4\u7238\u7238', Decimal('666946'), Decimal('468975'), 42.2], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', Decimal('758053'), Decimal('532266'), 42.4], [u'\u72d0\u5996\u5c0f\u7ea2\u5a18', Decimal('685134'), Decimal('455458'), 50.4], [u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', Decimal('670797'), Decimal('417987'), 60.5], [u'\u661f\u517d\u730e\u4eba', Decimal('1126701'), Decimal('620404'), 81.6], [u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', Decimal('2307506'), Decimal('1236930'), 86.6]]
{'decrease_vv': [-0.4, -3.3, -4.5, -10.4], 'decrease_name': [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', u'\u5154\u5c0f\u8d1d\u513f\u6b4c', u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63'], 'increase_vv': [33.6, 35.5, 35.8, 39.1, 42.2, 42.4, 50.4, 60.5, 81.6, 86.6], 'increase_name': [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', u'\u87ba\u4e1d\u9489', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', u'\u5df4\u5df4\u7238\u7238', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', u'\u72d0\u5996\u5c0f\u7ea2\u5a18', u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', u'\u661f\u517d\u730e\u4eba', u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (8427,290982,313803,290227,307839,156998,168521,312567,310504,167972,309588,291325,311038,304867,309973,293426,293609,292159,291089,313650,312413,313106,313589,293435) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a
cms_result: ['310504', '293435', '290982', '293426', '304867', '291089', '293609', '309588', '167972', '313650', '168521', '8427', '312567', '311038', '309973', '292159', '307839', '291325', '313589', '313106', '156998', '312413', '313803', '290227']
uv_pid_day_avg_result: ['313589', '310504', '307839', '312413', '304867', '312567', '290982', '311038', '167972', '292159', '310504', '309973', '291089', '8427', '293426', '313803', '291325', '313589', '293609', '168521', '309973', '291089', '313106', '290227', '293426', '293609', '310504', '313650', '312413', '293435', '310504', '309973', '313803', '313106', '291089', '313589', '8427', '309588', '291325', '156998']
vv_pid_day_avg_result: ['156998', '313650', '312413', '312567', '291325', '304867', '309973', '290982', '290982', '168521', '291325', '307839', '293426', '291325', '290227', '156998', '167972', '311038', '313106', '8427', '156998', '309973', '313106', '309973', '8427', '313650', '290227', '290227', '156998', '293609', '293435', '313589', '8427', '293609', '293609', '310504', '313803', '312567', '309588', '309588', '291089', '312567', '292159', '290982', '291089', '293609', '167972', '167972', '309588', '291089', '293435', '313589', '313106', '8427', '310504', '309973', '292159', '307839', '312413', '311038', '311038', '309588', '292159', '293426', '304867', '313803', '293426', '313803', '168521', '310504', '313106', '312567', '168521', '167972', '292159', '293426', '311038', '304867', '168521', '307839', '304867', '313589', '307839', '313589', '291089', '313803', '313650', '290227', '293435', '290982', '291325', '293435', '312413', '312413', '310504', '313650']
[[[5.4, 17.6, 3.3, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'pcweb'], [3.9, 9.6, 2.5, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'pcweb'], [2.6, 16.8, 6.4, u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', 'pcweb'], [1.9, 6.7, 3.5, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'pcweb'], [1.1, 5.5, 4.9, u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', 'pcweb'], [1.1, 4.8, 4.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', 'pcweb'], [1.0, 5.7, 5.4, u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', 'pcweb'], [1.0, 1.8, 1.8, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', 'pcweb'], [1.0, 5.2, 5.2, u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u5168\u96c6', 'pcweb'], [0.9, 6.3, 6.7, u'\u75af\u72c2\u7684\u5154\u5b50 \u7b2c\u4e8c\u5b63', 'pcweb']], [[2.2, 12.0, 5.4, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'android'], [1.9, 12.1, 6.3, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'android'], [1.9, 4.1, 2.2, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'android'], [1.4, 5.1, 3.6, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'android'], [1.4, 6.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'android'], [1.1, 3.3, 3.0, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'android'], [1.1, 7.1, 6.5, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'android'], [1.1, 3.3, 3.0, u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', 'android'], [1.0, 5.8, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'android'], [1.0, 3.8, 3.9, u'\u72d0\u5996\u5c0f\u7ea2\u5a18', 'android']], [[0.6, 3.8, 6.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'iphone'], [0.4, 3.0, 6.6, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'iphone'], [0.3, 1.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'iphone'], [0.3, 2.3, 6.8, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'iphone'], [0.3, 1.8, 6.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'iphone'], [0.3, 0.7, 2.4, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'iphone'], [0.2, 1.3, 5.7, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'iphone'], [0.2, 0.6, 2.9, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'iphone'], [0.2, 1.1, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'iphone'], [0.2, 0.8, 4.4, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', 'iphone']], [[12.2, 74.1, 6.1, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'ott'], [5.2, 54.2, 10.5, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'ott'], [4.8, 15.6, 3.3, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'ott'], [4.5, 143.6, 31.9, u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', 'ott'], [4.4, 24.2, 5.6, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'ott'], [4.0, 35.7, 9.0, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'ott'], [3.9, 11.4, 3.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'ott'], [3.7, 11.1, 3.0, u'\u661f\u517d\u730e\u4eba', 'ott'], [2.5, 12.1, 4.8, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'ott'], [2.5, 38.7, 15.6, u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 4/7] 172.31.24.94 () {42 vars in 870 bytes} [Thu Apr 13 02:38:50 2017] GET /display/channel/?name=cartoon => generated 27459 bytes in 4220 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170411' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170313' and date<='20170411' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170411' GROUP BY date) a;
[(Decimal('109847281.09090909'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170313' and date<='20170411' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170313' and date<='20170411' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 5.89230585098
[pid: 32094|app: 0|req: 5/8] 10.100.253.14 () {50 vars in 1027 bytes} [Thu Apr 13 02:58:45 2017] POST /display/ => generated 29165 bytes in 5906 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170412' GROUP BY date) a;
[(Decimal('107957560.500000000000'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 4.71641302109
[pid: 32094|app: 0|req: 6/9] 10.100.253.14 () {50 vars in 1027 bytes} [Thu Apr 13 02:59:21 2017] POST /display/ => generated 29157 bytes in 4730 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
[pid: 32094|app: 0|req: 7/10] 10.100.253.14 () {40 vars in 746 bytes} [Thu Apr 13 03:55:22 2017] GET /display/channel?name=show => generated 0 bytes in 1 msecs (HTTP/1.1 301) 2 headers in 113 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '308734', '308710', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '308703', '312733', '310398', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 8/11] 10.100.253.14 () {40 vars in 748 bytes} [Thu Apr 13 03:55:22 2017] GET /display/channel/?name=show => generated 27653 bytes in 7086 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
[pid: 32094|app: 0|req: 9/12] 10.100.253.14 () {40 vars in 751 bytes} [Thu Apr 13 08:18:55 2017] GET /display => generated 0 bytes in 1 msecs (HTTP/1.1 301) 2 headers in 95 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170412' GROUP BY date) a;
[(Decimal('107957560.500000000000'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170314' and date<='20170412' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170314' and date<='20170412' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 5.30523300171
[pid: 32094|app: 0|req: 10/13] 10.100.253.14 () {40 vars in 753 bytes} [Thu Apr 13 08:18:55 2017] GET /display/ => generated 29157 bytes in 5336 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
[pid: 32094|app: 0|req: 11/14] 10.100.253.14 () {42 vars in 835 bytes} [Thu Apr 13 08:19:04 2017] GET /display/channel?name=show => generated 0 bytes in 1 msecs (HTTP/1.1 301) 2 headers in 113 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['308734', '308710', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '308703', '312733', '310398', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 12/15] 10.100.253.14 () {42 vars in 837 bytes} [Thu Apr 13 08:19:04 2017] GET /display/channel/?name=show => generated 27653 bytes in 3999 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['308734', '308710', '308921', '308703', '312733', '310398', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '309556', '308703', '310102', '291976', '308703', '291976', '308921']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 13/16] 10.100.253.14 () {42 vars in 855 bytes} [Thu Apr 13 08:54:14 2017] GET /display/channel/?name=show => generated 27653 bytes in 3837 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170412' and bid not in (2,4) and cid in (7,88) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170401' and date<='20170412' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (7,88) and date>='20170314' and date<='20170412' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (7,88) and date>='20170327' and date<='20170402' and pid in (8427,290982,8031,307747,290227,291076,307839,168568,168521,9148,312567,310504,312413,291174,309588,291325,151066,311038,304867,309973,302045,310404,159339,156998,308378,48267,293426,310880,167540,155982,293609,310803,292056,168154,309257,294247,56215,150723,296178,168519,291088,291089,313650,311589,291080,313106,313589,292555,293435,158776) group by pid 
pid_vv_change_list: [[u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', Decimal('7081733'), Decimal('7904325'), -10.4], [u'\u5154\u5c0f\u8d1d\u513f\u6b4c', Decimal('740680'), Decimal('775183'), -4.5], [u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', Decimal('1504079'), Decimal('1554670'), -3.3], [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', Decimal('2297643'), Decimal('2305958'), -0.4], [u'\u8d1d\u74e6\u513f\u6b4c', Decimal('2896049'), Decimal('2882117'), 0.5], [u'\u732a\u732a\u4fa0\uff1a\u5fae\u80d6\u754c\u7684\u8d85\u7ea7\u82f1\u96c4', Decimal('1439178'), Decimal('1382881'), 4.1], [u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', Decimal('706408'), Decimal('676701'), 4.4], [u'\u96f6\u96f6\u5927\u5192\u9669\u7cbe\u5f69\u96c6\u9526', Decimal('690204'), Decimal('653297'), 5.6], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', Decimal('1098931'), Decimal('1009239'), 8.9], [u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', Decimal('3037070'), Decimal('2775146'), 9.4], [u'\u5c0f\u9e21Jaki\u5728\u54ea\u513f', Decimal('3914657'), Decimal('3574653'), 9.5], [u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', Decimal('10897428'), Decimal('9904284'), 10.0], [u'\u5012\u9709\u718a \u7b2c\u4e09\u5b63', Decimal('1015870'), Decimal('921306'), 10.3], [u'larva\uff08\u7206\u7b11\u866b\u5b50\uff09\u5168\u96c6', Decimal('704660'), Decimal('638585'), 10.3], [u'\u8d85\u7ea7\u6c6a\u6c6a\u961f\u8054\u76df', Decimal('657208'), Decimal('593448'), 10.7], [u'\u6885\u897f\u53bb\u4e50\u8da3\u5c9b', Decimal('738442'), Decimal('664008'), 11.2], [u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', Decimal('2750522'), Decimal('2460975'), 11.8], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u513f\u6b4c\u7cfb\u5217', Decimal('936396'), Decimal('835841'), 12.0], [u'\u6211\u7684\u4f1a\u8bf4\u8bdd\u7684\u6c64\u59c6', Decimal('2801590'), Decimal('2472817'), 13.3], [u'\u4e09\u53ea\u5154\u5b50', Decimal('669635'), Decimal('589320'), 13.6], [u'\u5b9d\u5b9d\u5df4\u58eb\u4e4b\u795e\u5947\u7b80\u7b14\u753b', Decimal('1139431'), Decimal('995362'), 14.5], [u'\u5947\u79ef\u4e50\u56ed', Decimal('678559'), Decimal('586322'), 15.7], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e8c\u5b63', Decimal('1541227'), Decimal('1328697'), 16.0], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', Decimal('2788136'), Decimal('2384484'), 16.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', Decimal('1335347'), Decimal('1141019'), 17.0], [u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', Decimal('1144790'), Decimal('974655'), 17.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c3\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u65b0\u5927\u5934\u513f\u5b50\u548c\u5c0f\u5934\u7238\u7238 \u7b2c\u4e09\u5b63', Decimal('1079573'), Decimal('911093'), 18.5], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e09\u5b63', Decimal('751866'), Decimal('631381'), 19.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e00\u5b63', Decimal('1274685'), Decimal('1069057'), 19.2], [u'\u5c0f\u9ec4\u4eba\u756a\u5916\u7bc7\u5408\u96c6', Decimal('1062982'), Decimal('885149'), 20.1], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', Decimal('746238'), Decimal('620773'), 20.2], [u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', Decimal('1785943'), Decimal('1473041'), 21.2], [u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', Decimal('1484909'), Decimal('1223637'), 21.4], [u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', Decimal('4527298'), Decimal('3715107'), 21.9], [u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', Decimal('5124565'), Decimal('4188583'), 22.3], [u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', Decimal('3296093'), Decimal('2673396'), 23.3], [u'\u6b22\u4e50\u8d31\u840c\u5c0f\u9ec4\u4eba\u52a8\u753b\u96c6\u9526', Decimal('836978'), Decimal('668634'), 25.2], [u'\u6b22\u4e50\u5947\u8da3\u86cb', Decimal('697826'), Decimal('548590'), 27.2], [u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', Decimal('3275074'), Decimal('2550141'), 28.4], [u'\u6d77\u5e95\u5c0f\u7eb5\u961f \u7b2c\u56db\u5b63', Decimal('941896'), Decimal('706659'), 33.3], [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', Decimal('1069425'), Decimal('800254'), 33.6], [u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', Decimal('1561363'), Decimal('1152511'), 35.5], [u'\u87ba\u4e1d\u9489', Decimal('1925157'), Decimal('1417198'), 35.8], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', Decimal('897725'), Decimal('645331'), 39.1], [u'\u5df4\u5df4\u7238\u7238', Decimal('666946'), Decimal('468975'), 42.2], [u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', Decimal('758053'), Decimal('532266'), 42.4], [u'\u72d0\u5996\u5c0f\u7ea2\u5a18', Decimal('685134'), Decimal('455458'), 50.4], [u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', Decimal('670797'), Decimal('417987'), 60.5], [u'\u661f\u517d\u730e\u4eba', Decimal('1126701'), Decimal('620404'), 81.6], [u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', Decimal('2307506'), Decimal('1236930'), 86.6]]
{'decrease_vv': [-0.4, -3.3, -4.5, -10.4], 'decrease_name': [u'\u5947\u5b9d\u840c\u5175 \u7b2c\u4e00\u5b63', u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', u'\u5154\u5c0f\u8d1d\u513f\u6b4c', u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63'], 'increase_vv': [33.6, 35.5, 35.8, 39.1, 42.2, 42.4, 50.4, 60.5, 81.6, 86.6], 'increase_name': [u'\u718a\u51fa\u6ca1\u4e4b\u82f1\u718a\u8054\u76df', u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', u'\u87ba\u4e1d\u9489', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e8c\u5b63', u'\u5df4\u5df4\u7238\u7238', u'\u8721\u7b14\u5c0f\u65b0 \u7b2c\u4e94\u5b63', u'\u72d0\u5996\u5c0f\u7ea2\u5a18', u'\u661f\u5b66\u96622\u6708\u7075\u624b\u73af', u'\u661f\u517d\u730e\u4eba', u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (8427,290982,313803,290227,307839,156998,168521,312567,310504,167972,309588,291325,311038,304867,309973,293426,293609,292159,291089,313650,312413,313106,313589,293435) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (7,88) GROUP BY bid,pid) a
cms_result: ['310504', '293435', '290982', '293426', '304867', '291089', '293609', '309588', '167972', '313650', '168521', '8427', '312567', '311038', '309973', '292159', '307839', '291325', '313589', '313106', '156998', '312413', '313803', '290227']
uv_pid_day_avg_result: ['313589', '310504', '307839', '312413', '304867', '312567', '290982', '311038', '167972', '292159', '310504', '309973', '291089', '8427', '293426', '313803', '291325', '313589', '293609', '168521', '309973', '291089', '313106', '290227', '293426', '293609', '310504', '313650', '312413', '293435', '310504', '309973', '313803', '313106', '291089', '313589', '8427', '309588', '291325', '156998']
vv_pid_day_avg_result: ['168521', '167972', '292159', '293426', '311038', '304867', '168521', '307839', '304867', '313589', '307839', '313589', '291089', '313803', '310504', '309973', '292159', '307839', '312413', '311038', '311038', '309588', '292159', '293426', '304867', '313803', '293426', '313803', '168521', '310504', '313106', '312567', '156998', '313650', '312413', '312567', '291325', '304867', '309973', '290982', '290982', '168521', '291325', '307839', '293609', '293609', '310504', '313803', '312567', '309588', '309588', '291089', '312567', '292159', '290982', '313650', '290227', '293435', '290982', '291325', '293435', '312413', '312413', '310504', '313650', '291089', '293609', '167972', '167972', '309588', '291089', '293435', '313589', '313106', '8427', '313650', '290227', '290227', '156998', '293609', '293435', '313589', '8427', '293426', '291325', '290227', '156998', '167972', '311038', '313106', '8427', '156998', '309973', '313106', '309973', '8427']
[[[5.4, 17.6, 3.3, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'pcweb'], [3.9, 9.6, 2.5, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'pcweb'], [2.6, 16.8, 6.4, u'\u65b0\u732b\u548c\u8001\u9f20 \u7b2c\u4e8c\u5b63', 'pcweb'], [1.9, 6.7, 3.5, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'pcweb'], [1.1, 5.5, 4.9, u'\u732a\u732a\u4fa0\u4e4b\u68a6\u60f3\u5b88\u536b\u8005', 'pcweb'], [1.1, 4.8, 4.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f\u5168\u96c6', 'pcweb'], [1.0, 5.7, 5.4, u'\u8d85\u7ea7\u98de\u4fa0\u5168\u96c6', 'pcweb'], [1.0, 1.8, 1.8, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63 \u82f1\u6587\u7248', 'pcweb'], [1.0, 5.2, 5.2, u'\u6d77\u5e95\u5c0f\u7eb5\u961f\u5168\u96c6', 'pcweb'], [0.9, 6.3, 6.7, u'\u75af\u72c2\u7684\u5154\u5b50 \u7b2c\u4e8c\u5b63', 'pcweb']], [[2.2, 12.0, 5.4, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'android'], [1.9, 12.1, 6.3, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'android'], [1.9, 4.1, 2.2, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'android'], [1.4, 5.1, 3.6, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'android'], [1.4, 6.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'android'], [1.1, 3.3, 3.0, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'android'], [1.1, 7.1, 6.5, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'android'], [1.1, 3.3, 3.0, u'\u732a\u732a\u4fa0\u4e4b\u82f1\u96c4\u732a\u5c11\u5e74', 'android'], [1.0, 5.8, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'android'], [1.0, 3.8, 3.9, u'\u72d0\u5996\u5c0f\u7ea2\u5a18', 'android']], [[0.6, 3.8, 6.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'iphone'], [0.4, 3.0, 6.6, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'iphone'], [0.3, 1.8, 5.0, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'iphone'], [0.3, 2.3, 6.8, u'\u5c0f\u732a\u4f69\u5947\u5168\u96c6', 'iphone'], [0.3, 1.8, 6.2, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'iphone'], [0.3, 0.7, 2.4, u'\u5076\u50cfX\u6218\u58eb\u5947\u8ff9\u4e4b\u97f3', 'iphone'], [0.2, 1.3, 5.7, u'\u718a\u51fa\u6ca1\u4e4b\u590f\u65e5\u8fde\u8fde\u770b', 'iphone'], [0.2, 0.6, 2.9, u'\u79ef\u9ad8\u4fa0\u4e0e\u963f\u91cc\u5df4\u5df4', 'iphone'], [0.2, 1.1, 5.8, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'iphone'], [0.2, 0.8, 4.4, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u4e00\u5b63', 'iphone']], [[12.2, 74.1, 6.1, u'\u8d85\u7ea7\u98de\u4fa0 \u7b2c\u4e09\u5b63', 'ott'], [5.2, 54.2, 10.5, u'\u5c0f\u732a\u4f69\u5947 \u7b2c\u56db\u5b63', 'ott'], [4.8, 15.6, 3.3, u'\u6597\u9f99\u6218\u58eb \u7b2c\u4e94\u5b63', 'ott'], [4.5, 143.6, 31.9, u'\u5b9d\u5b9d\u5df4\u58eb\u513f\u6b4c', 'ott'], [4.4, 24.2, 5.6, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e8c\u5b63', 'ott'], [4.0, 35.7, 9.0, u'\u718a\u51fa\u6ca1\u4e4b\u79cb\u65e5\u56e2\u56e2\u8f6c', 'ott'], [3.9, 11.4, 3.0, u'\u6c6a\u6c6a\u961f\u7acb\u5927\u529f \u7b2c\u4e09\u5b63', 'ott'], [3.7, 11.1, 3.0, u'\u661f\u517d\u730e\u4eba', 'ott'], [2.5, 12.1, 4.8, u'\u5c0f\u516c\u4e3b\u82cf\u83f2\u4e9a', 'ott'], [2.5, 38.7, 15.6, u'\u7206\u7b11\u866b\u5b50 \u7b2c\u4e09\u5b63', 'ott']]]
29 28 22
[pid: 32094|app: 0|req: 14/17] 172.31.24.94 () {40 vars in 800 bytes} [Thu Apr 13 10:30:57 2017] GET /display/channel/?name=cartoon => generated 27459 bytes in 12211 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170413' GROUP BY date) a;
[(Decimal('106563217.538461538462'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 3.52238106728
[pid: 32094|app: 0|req: 15/18] 10.100.253.14 () {42 vars in 820 bytes} [Fri Apr 14 02:03:58 2017] GET /display/ => generated 29155 bytes in 3535 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
Gracefully killing worker 4 (pid: 32094)...
Gracefully killing worker 3 (pid: 32093)...
Gracefully killing worker 2 (pid: 32092)...
Gracefully killing worker 1 (pid: 32091)...
...gracefully killing workers...
worker 1 buried after 1 seconds
worker 2 buried after 1 seconds
worker 3 buried after 1 seconds
worker 4 buried after 1 seconds
binary reloading uWSGI...
chdir() to /root/hf/integrated_display
closing all non-uwsgi socket fds > 2 (max_fd = 102400)...
found fd 3 mapped to socket 0 (:8099)
running /usr/local/Python2.7/bin/uwsgi
[uWSGI] getting INI configuration from integrated_display_uwsgi.ini
*** Starting uWSGI 2.0.14 (64bit) on [Fri Apr 14 02:26:20 2017] ***
compiled with version: 4.4.7 20120313 (Red Hat 4.4.7-11) on 08 March 2017 11:44:30
os: Linux-2.6.32-358.el6.x86_64 #1 SMP Fri Feb 22 00:31:26 UTC 2013
nodename: localhost.localdomain
machine: x86_64
clock source: unix
pcre jit disabled
detected number of CPU cores: 4
current working directory: /root/hf/integrated_display
detected binary path: /usr/local/Python2.7/bin/uwsgi
uWSGI running as root, you can use --uid/--gid/--chroot options
*** WARNING: you are running uWSGI as root !!! (use the --uid flag) *** 
chdir() to /root/hf/integrated_display
your processes number limit is 256500
your memory page size is 4096 bytes
detected max file descriptor number: 102400
lock engine: pthread robust mutexes
thunder lock: disabled (you can enable it with --thunder-lock)
uwsgi socket 0 inherited INET address :8099 fd 3
Python version: 2.7.12 (default, Jul 13 2016, 11:19:57)  [GCC 4.4.7 20120313 (Red Hat 4.4.7-11)]
*** Python threads support is disabled. You can enable it with --enable-threads ***
Python main interpreter initialized at 0x2214900
your server socket listen backlog is limited to 100 connections
your mercy for graceful operations on workers is 60 seconds
mapped 363840 bytes (355 KB) for 4 cores
*** Operational MODE: preforking ***
WSGI app 0 (mountpoint='') ready in 0 seconds on interpreter 0x2214900 pid: 32074 (default app)
*** uWSGI is running in multiple interpreter mode ***
gracefully (RE)spawned uWSGI master process (pid: 32074)
spawned uWSGI worker 1 (pid: 1257, cores: 1)
spawned uWSGI worker 2 (pid: 1258, cores: 1)
spawned uWSGI worker 3 (pid: 1259, cores: 1)
spawned uWSGI worker 4 (pid: 1260, cores: 1)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170413' GROUP BY date) a;
[(Decimal('106563217.538461538462'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 4.26333999634
[pid: 1259|app: 0|req: 1/1] 172.31.25.168 () {42 vars in 852 bytes} [Fri Apr 14 03:00:57 2017] GET /display/ => generated 29155 bytes in 4311 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
[pid: 1260|app: 0|req: 1/2] 172.31.25.168 () {42 vars in 869 bytes} [Fri Apr 14 03:01:28 2017] GET /display/channel?name=show => generated 0 bytes in 19 msecs (HTTP/1.1 301) 2 headers in 113 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170413' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '308703', '312733', '310398', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '308734', '308710', '308921']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 1260|app: 0|req: 2/3] 172.31.25.168 () {42 vars in 871 bytes} [Fri Apr 14 03:01:28 2017] GET /display/channel/?name=show => generated 27648 bytes in 4616 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170413' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['308734', '308710', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '308703', '312733', '310398', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 1260|app: 0|req: 3/4] 10.100.253.14 () {42 vars in 837 bytes} [Fri Apr 14 04:25:17 2017] GET /display/channel/?name=show => generated 27648 bytes in 3685 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170413' GROUP BY date) a;
[(Decimal('106563217.538461538462'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 3.06338095665
[pid: 1260|app: 0|req: 4/5] 10.100.253.14 () {42 vars in 820 bytes} [Fri Apr 14 04:25:23 2017] GET /display/ => generated 29155 bytes in 3076 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170413' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '308734', '308710', '308921', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '309556', '308703', '310102', '291976', '308703', '291976', '308921', '308703', '312733', '310398']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 1260|app: 0|req: 5/6] 172.31.25.168 () {44 vars in 902 bytes} [Fri Apr 14 05:31:34 2017] GET /display/channel/?name=show => generated 27648 bytes in 5667 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) and cid in (1,87) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170401' and date<='20170413' GROUP BY date) a;
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and cid in (1,87) and date>='20170315' and date<='20170413' group by date,bid order by date
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170403' and date<='20170409' group by pid order by sum(vv) desc limit 50
select pid,sum(vv) as vv from vv_pid_day where bid not in (2,4) and cid in (1,87) and date>='20170327' and date<='20170402' and pid in (291976,298442,311259,308811,308812,290349,290346,309918,41661,308627,310348,156479,157139,310611,295121,308703,312733,290525,292405,309556,308801,53014,312692,310860,293709,310491,291337,157780,291580,109830,45300,292390,105380,310102,308710,311113,310775,298050,167900,108005,10096,308921,308734,309803,106040,313024,312947,101575,159187,309715) group by pid 
pid_vv_change_list: [[u'2017\u5feb\u4e50\u7537\u58f0', Decimal('2962254'), Decimal('4839540'), -38.8], [u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', Decimal('407476'), Decimal('633583'), -35.7], [u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', Decimal('412540'), Decimal('509692'), -19.1], [u'\u4e3a\u4f60\u800c\u6765', Decimal('1002100'), Decimal('1016674'), -1.4], [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', Decimal('3083935'), Decimal('3108873'), -0.8], [u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', Decimal('661161'), Decimal('666196'), -0.8], [u'\u6b4c\u624b\u591a\u770b\u70b9', Decimal('437292'), Decimal('430095'), 1.7], [u'\u660e\u661f\u5927\u4fa6\u63a2', Decimal('3773643'), Decimal('3606968'), 4.6], [u'\u6211\u662f\u6b4c\u624b \u7b2c\u56db\u5b63', Decimal('516008'), Decimal('492692'), 4.7], [u'2017\u6625\u665a\u7cbe\u5f69\u5168\u56de\u987e', Decimal('598782'), Decimal('568639'), 5.3], [u'\u8292\u679c\u635e\u661f\u95fb 2016', Decimal('1235206'), Decimal('1158390'), 6.6], [u'\u548c\u6b4c\u624b\u5728\u4e00\u8d77', Decimal('762584'), Decimal('712234'), 7.1], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e00\u5b63', Decimal('644317'), Decimal('595387'), 8.2], [u'\u6b4c\u624b', Decimal('18104882'), Decimal('16643395'), 8.8], [u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', Decimal('4498668'), Decimal('4115562'), 9.3], [u'\u5b8b\u5c0f\u5b9d\u6b22\u4e50\u79c0', Decimal('495010'), Decimal('439473'), 12.6], [u'\u6211\u60f3\u548c\u4f60\u5531', Decimal('796830'), Decimal('693727'), 14.9], [u'\u8292\u679c\u635e\u661f\u95fb 2017', Decimal('6882211'), Decimal('5978707'), 15.1], [u'\u6211\u4eec\u7684\u6b4c\u624b 2017', Decimal('960820'), Decimal('832341'), 15.4], [u'\u5929\u5929\u5411\u4e0a 2016', Decimal('634564'), Decimal('548112'), 15.8], [u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', Decimal('24782707'), Decimal('21390156'), 15.9], [u'\u660e\u661f\u5927\u4fa6\u63a22\u7cbe\u5f69\u770b\u70b9', Decimal('893297'), Decimal('762741'), 17.1], [u'\u795e\u5947\u7684\u5b69\u5b50', Decimal('3546048'), Decimal('2987739'), 18.7], [u'\u53d8\u5f62\u8ba1 \u7b2c\u5341\u4e8c\u5b63', Decimal('1061515'), Decimal('884528'), 20.0], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u56db\u5b63', Decimal('1766357'), Decimal('1448452'), 21.9], [u'\u6211\u4eec\u6765\u4e86', Decimal('935402'), Decimal('756983'), 23.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2016', Decimal('3373294'), Decimal('2722430'), 23.9], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e00\u5b63', Decimal('442680'), Decimal('357038'), 24.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2017', Decimal('38683922'), Decimal('30658168'), 26.2], [u'\u5929\u5929\u5411\u4e0a 2017', Decimal('7351995'), Decimal('5788048'), 27.0], [u'\u8ff7\u59b9\u5927\u672c\u8425 2017', Decimal('448375'), Decimal('352872'), 27.1], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e09\u5b63', Decimal('447487'), Decimal('350203'), 27.8], [u'\u7efc\u827a\u54c8\u54c8\u79c0', Decimal('541774'), Decimal('420672'), 28.8], [u'\u5988\u5988\u662f\u8d85\u4eba', Decimal('6382543'), Decimal('4948004'), 29.0], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e8c\u5b63', Decimal('883819'), Decimal('674870'), 31.0], [u'\u5feb\u4e50\u5927\u672c\u8425 2013', Decimal('432051'), Decimal('329117'), 31.3], [u'\u5feb\u4e50\u5927\u672c\u8425 2015', Decimal('1646422'), Decimal('1251242'), 31.6], [u'\u5feb\u4e50\u5927\u672c\u8425 2014', Decimal('937620'), Decimal('710753'), 31.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e00\u5b63', Decimal('812733'), Decimal('613208'), 32.5], [u'\u7238\u7238\u53bb\u54ea\u513f \u7b2c\u4e8c\u5b63', Decimal('490665'), Decimal('363626'), 34.9], [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', Decimal('41217377'), Decimal('29335704'), 40.5], [u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', Decimal('515762'), Decimal('354322'), 45.6], [u'\u5411\u5f80\u7684\u751f\u6d3b', Decimal('91494310'), Decimal('61851444'), 47.9], [u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', Decimal('597400'), Decimal('400264'), 49.3], [u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', Decimal('556921'), Decimal('370731'), 50.2], [u'\u5076\u50cf\u6765\u4e86', Decimal('2465984'), Decimal('1532884'), 60.9], [u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', Decimal('627444'), Decimal('355360'), 76.6], [u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', Decimal('1671855'), Decimal('882216'), 89.5], [u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', Decimal('5902512'), Decimal('1458969'), 304.6], [u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63', Decimal('2188145'), Decimal('202259'), 981.9]]
{'decrease_vv': [-0.8, -0.8, -1.4, -19.1, -35.7, -38.8], 'decrease_name': [u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', u'\u771f\u6b63\u7537\u5b50\u6c49 \u7b2c\u4e8c\u5b63', u'\u4e3a\u4f60\u800c\u6765', u'\u6211\u60f3\u548c\u4f60\u5531 \u7b2c\u4e8c\u5b63', u'\u660e\u661f\u5927\u4fa6\u63a2\u7b2c\u4e8c\u5b63 \u5267\u573a\u7248', u'2017\u5feb\u4e50\u7537\u58f0'], 'increase_vv': [40.5, 45.6, 47.9, 49.3, 50.2, 60.9, 76.6, 89.5, 304.6, 981.9], 'increase_name': [u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', u'\u4e00\u5e74\u7ea7 \u6bd5\u4e1a\u5b63', u'\u5411\u5f80\u7684\u751f\u6d3b', u'\u5168\u5458\u52a0\u901f\u4e2d\u7b2c\u4e8c\u5b63', u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', u'\u5076\u50cf\u6765\u4e86', u'\u516b\u5366\u9274\u5b9a\u4e8b\u52a1\u6240 2017', u'\u7efc\u827a\u54c8\u54c8\u79c0 2017', u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', u'\u82b1\u513f\u4e0e\u5c11\u5e74 \u7b2c\u4e09\u5b63']}
select a.bid_name,a.pid,a.uv,a.rank from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(uv)/7) as uv,rank() over (partition by bid order by sum(uv)/7 desc) as rank from pid_uv_day where date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a where a.rank<='10'
select a.bid_name,a.pid,a.vv from (select case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,pid,round(sum(vv)/7) as vv from vv_pid_day where pid in (291976,310491,108005,291337,313024,308734,308703,312733,308921,309556,310102,310398,308710,290346,309803,308627) and date>='20170403' and date<='20170409' and bid in (1,102,9,12) and cid in (1,87) GROUP BY bid,pid) a
cms_result: ['310491', '308627', '308703', '308921', '308710', '291337', '310398', '308734', '291976', '310102', '108005', '309556', '312733', '309803', '313024', '290346']
uv_pid_day_avg_result: ['310102', '308710', '312733', '309556', '308921', '308734', '308703', '308627', '290346', '291976', '310102', '312733', '308710', '309556', '308921', '313024', '308703', '310491', '308734', '291337', '310102', '308710', '312733', '309556', '308921', '308734', '308627', '291337', '108005', '310398', '310102', '308710', '312733', '309556', '308921', '308703', '313024', '308734', '310491', '309803']
vv_pid_day_avg_result: ['308703', '312733', '310398', '308734', '308710', '308921', '308710', '308627', '310491', '308627', '291337', '309803', '290346', '290346', '308734', '108005', '310398', '310491', '310102', '310102', '308921', '308627', '310491', '308921', '291337', '290346', '313024', '312733', '291337', '291976', '309556', '308703', '309556', '308627', '290346', '308734', '309803', '313024', '308710', '308734', '309803', '291976', '308710', '313024', '310398', '310398', '309803', '312733', '313024', '310102', '310491', '312733', '309556', '291337', '309556', '308703', '310102', '291976', '308703', '291976', '308921']
[[[76.2, 207.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'pcweb'], [49.3, 89.7, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'pcweb'], [37.1, 75.8, 2.0, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'pcweb'], [35.9, 58.6, 1.6, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'pcweb'], [24.8, 52.6, 2.1, u'\u6b4c\u624b', 'pcweb'], [11.5, 20.2, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'pcweb'], [7.3, 14.1, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'pcweb'], [4.8, 9.0, 1.9, u'\u795e\u5947\u7684\u5b69\u5b50', 'pcweb'], [3.8, 8.3, 2.2, u'\u5feb\u4e50\u5927\u672c\u8425 2016', 'pcweb'], [3.7, 8.6, 2.3, u'\u660e\u661f\u5927\u4fa6\u63a2', 'pcweb']], [[188.6, 534.1, 2.8, u'\u5411\u5f80\u7684\u751f\u6d3b', 'android'], [126.7, 246.2, 1.9, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'android'], [103.0, 241.3, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'android'], [76.1, 166.1, 2.2, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'android'], [36.5, 82.4, 2.3, u'\u6b4c\u624b', 'android'], [28.0, 54.8, 2.0, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'android'], [27.6, 45.8, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'android'], [24.0, 43.1, 1.8, u'\u5929\u5929\u5411\u4e0a 2017', 'android'], [23.0, 33.6, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'android'], [13.1, 23.4, 1.8, u'\u540d\u4fa6\u63a2\u4ff1\u4e50\u90e8', 'android']], [[79.5, 212.6, 2.7, u'\u5411\u5f80\u7684\u751f\u6d3b', 'iphone'], [60.2, 136.4, 2.3, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'iphone'], [43.2, 77.3, 1.8, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'iphone'], [27.8, 54.4, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'iphone'], [20.4, 44.0, 2.2, u'\u6b4c\u624b', 'iphone'], [15.6, 26.3, 1.7, u'\u8d85\u4eba\u5988\u5988\u5e26\u5a03\u8bb0 \u7b2c\u4e8c\u5b63', 'iphone'], [10.8, 20.3, 1.9, u'\u8292\u679c\u635e\u661f\u95fb 2017', 'iphone'], [10.5, 15.4, 1.5, u'\u5411\u5f80\u7684\u751f\u6d3b \u7f51\u7edc\u7248', 'iphone'], [9.9, 16.5, 1.7, u'\u5929\u5929\u5411\u4e0a 2017', 'iphone'], [6.0, 19.9, 3.3, u'\u5988\u5988\u662f\u8d85\u4eba', 'iphone']], [[32.7, 130.2, 4.0, u'\u5411\u5f80\u7684\u751f\u6d3b', 'ott'], [17.9, 65.8, 3.7, u'\u5feb\u4e50\u5927\u672c\u8425 2017', 'ott'], [13.2, 33.9, 2.6, u'\u5988\u5988\u662f\u8d85\u4eba \u7b2c\u4e8c\u5b63', 'ott'], [12.2, 24.1, 2.0, u'\u660e\u661f\u5927\u4fa6\u63a2 \u7b2c\u4e8c\u5b63', 'ott'], [12.0, 35.0, 2.9, u'\u6b4c\u624b', 'ott'], [5.0, 10.9, 2.2, u'\u5929\u5929\u5411\u4e0a 2017', 'ott'], [2.9, 6.4, 2.2, u'\u795e\u5947\u7684\u5b69\u5b50', 'ott'], [1.6, 6.3, 4.0, u'\u5988\u5988\u662f\u8d85\u4eba', 'ott'], [1.5, 8.0, 5.2, u'\u6700\u65b0\u5c0f\u54c1\u96c6\u9526', 'ott'], [1.4, 3.0, 2.1, u'\u6700\u5f3a\u5927\u8111 \u7b2c\u56db\u5b63', 'ott']]]
29 28 22
[pid: 1260|app: 0|req: 6/7] 10.100.253.14 () {42 vars in 837 bytes} [Fri Apr 14 06:47:44 2017] GET /display/channel/?name=show => generated 27648 bytes in 4104 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
select substring(date from 1 for 6) as date,sum(vv) as vv from vv_cid_day where date>='20160101' and date<='20170413' and bid not in (2,4) GROUP BY substring(date from 1 for 6) order by substring(date from 1 for 6)
select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pv) as pv from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select date,sum(pt) as pt from pt_bid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date order by date
select avg(a.vv) as vv from (select date,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170401' and date<='20170413' GROUP BY date) a;
[(Decimal('106563217.538461538462'),)]
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case bid when 102 then 'pcweb' when 104 then 'phonem' when 11 then 'ipad' when 10 then 'apad' when 13 then 'mui' when 12 then 'iphone' when 1 then 'ott' when 5 then 'padweb' when 7 then 'win10client' when 6 then 'macclient' when 9 then 'android' when 8 then 'pcclient' else 'else' end as bid_name,sum(uv) as uv from bid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,bid order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(vv) as vv from vv_cid_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,case cid when 1 then 'show' when 3 then 'movie' when 2 then 'tv' when 88 then 'cartoon' when 7 then 'cartoon' when 83 then 'tv' when 87 then 'show' when 84 then 'movie' else 'else' end as cid_name,sum(uv) as uv from cid_uv_day where bid not in (2,4) and date>='20170315' and date<='20170413' group by date,cid_name order by date
select date,sum(uv) as dau from dau_bid_day where bid not in (2,4,5) and date>='20170315' and date<='20170413' group by date order by date
select pid,round(sum(uv)/7) as uv from pid_uv_day where bid not in (2,4) and date>='20170403' and date<='20170409' group by pid order by round(sum(uv)/7) desc limit 20
select pid,round(sum(vv)/7) as vv from vv_pid_day where bid not in (2,4) and pid in (310102,308710,312733,309556,312289,308921,312727,308734,314044,311928,308703,313024,310491,313702,-1,291337,308627,309803,290346,291976) and date>='20170403' and date<='20170409' group by pid order by round(sum(vv)/7) desc limit 20
time elapse is 3.72080492973
[pid: 1260|app: 0|req: 7/8] 10.100.253.14 () {42 vars in 820 bytes} [Fri Apr 14 07:10:21 2017] GET /display/ => generated 29155 bytes in 3733 msecs (HTTP/1.1 200) 4 headers in 256 bytes (1 switches on core 0)
